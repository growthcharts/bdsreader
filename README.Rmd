---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# bdsreader

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/growthcharts/bdsreader/workflows/R-CMD-check/badge.svg)](https://github.com/growthcharts/bdsreader/actions)
<!-- badges: end -->

The `bdsreader` package is a lightweight package that

- Reads and parses child data coded according to the Basisdataset JGZ protocol;
- Compares the child data against one of two JSON validation schema;
- Calculates the child's D-score from the Van Wiechen Schema (DDI) responses;
- Adds Z-scores for height, weight, head circumference, BMI, weight-for-height and D-score;
- Converts the result into a structured `tibble` with a special `person` attribute;

The `bdsreader` translates child data (incoming via an API request) into a data object useful for `R` processing. The package is part of Joint Automatic Measurement and Evaluation System (JAMES) developed by the Netherlands Organisation for Applied Scientific Research TNO.

## Installation

Install the development version `bdsreader` by

```{r eval = FALSE}
install.packages("remotes")
remotes::install_github("growthcharts/bdsreader")
```

There is no CRAN release.

## Example

The following commands illustrate the main use of `bdsreader`.

```{r}
library(bdsreader)
fn <- system.file("examples", "maria.json", package = "bdsreader")
xyz <- read_bds(fn, format = 1)
xyz
```

Column `age` in the result `xyz` holds decimal age for the measurement. Every row contains a measurement `yname`, the conditioning variable `xname` and the Z-score `zname`. The column named `zref` holds the name of the growth reference (as defined in the `nlreference` package) used to calculate the Z-score. Columns `y`, `x` and `z` store their values, respectively. 

The `persondata()` function returns the person-level information:

```{r}
persondata(xyz)
```

The result of `read_bds()` feeds into further data processing in `R`.

## Breakdown in steps

### JSON Input Data

The example file `maria.json` contains Maria's data coded in JSON format according to BDS-schema file [bds_1.0.json](https://raw.githubusercontent.com/growthcharts/bdsreader/master/inst/schemas/bds_v1.0.json). Here's the contents of the file with the child data:

```
{
   "Referentie":"Maria",
   "OrganisatieCode":1234,
   "ClientGegevens":{
      "Elementen":[
         {
            "Bdsnummer":19,
            "Waarde":"2"
         },
         {
            "Bdsnummer":20,
            "Waarde":"20181011"
         },
         {
            "Bdsnummer":82,
            "Waarde":189
         },
         {
            "Bdsnummer":91,
            "Waarde":"1"
         },
         {
            "Bdsnummer":110,
            "Waarde":990
         },
         {
            "Bdsnummer":238,
            "Waarde":1670
         },
         {
            "Bdsnummer":240,
            "Waarde":1900
         }
      ],
      "Groepen":[
         {
            "Elementen":[
               {
                  "Bdsnummer":63,
                  "Waarde":"19950704"
               },
               {
                  "Bdsnummer":71,
                  "Waarde":6030
               },
               {
                  "Bdsnummer":62,
                  "Waarde":"01"
               }
            ]
         },
         {
            "Elementen":[
               {
                  "Bdsnummer":63,
                  "Waarde":"19901202"
               },
               {
                  "Bdsnummer":71,
                  "Waarde":6030
               },
               {
                  "Bdsnummer":62,
                  "Waarde":"02"
               }
            ]
         }
      ]
   },
   "Contactmomenten":[
      {
         "Tijdstip":"20181111",
         "Elementen":[
            {
               "Bdsnummer":235,
               "Waarde":380
            },
            {
               "Bdsnummer":245,
               "Waarde":1250
            },
            {
               "Bdsnummer":252,
               "Waarde":270
            }
         ]
      },
      {
         "Tijdstip":"20181211",
         "Elementen":[
            {
               "Bdsnummer":235,
               "Waarde":435
            },
            {
               "Bdsnummer":245,
               "Waarde":2100
            },
            {
               "Bdsnummer":252,
               "Waarde":305
            }
         ]
      }
   ]
}
```

JSON is a lightweight format to exchange data between electronic systems. `"Bdsnummer"` fields refer to the numbers defined in the Basisdataset JGZ, whereas `"Waarde"` fields contain the value. You can find the exact specification [here](here). 

### Read and parse input data

### Validate input data

### Age calculation

### D-score calculation

### Z-score calculation

### Structure of result

## Further information

